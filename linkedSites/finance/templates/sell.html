{% extends "layout.html" %}

{% block title %}
    Sell
{% endblock %}

{% block main %}
<form action="/sell" method="post">

    <!-- Stock Dropdown -->
    <div class="mb-3">
        <select name="symbol"
                id="symbolSelect"
                class="form-control mx-auto w-auto"
                required
                onchange="updateMax()">
            <option disabled selected>Select Stock</option>
            {% for stock in stocks %}
                <option value="{{ stock.symbol }}"
                        data-shares="{{ stock.shares }}">
                    {{ stock.symbol }} ({{ stock.shares }} shares)
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Shares Input + Max Button -->
    <div class="mb-3 d-flex justify-content-center align-items-center gap-2">
        <input
            id="sharesInput"
            class="form-control w-auto"
            name="shares"
            placeholder="Shares to sell"
            type="number"
            min="1"
            required
        >
        <button type="button"
                class="btn btn-outline-secondary"
                onclick="setMax()">
            Max
        </button>
    </div>

    <button class="btn btn-primary" type="submit">Sell</button>
</form>

<script>
function updateMax() {
    const select = document.getElementById("symbolSelect");
    const selectedOption = select.options[select.selectedIndex];
    const maxShares = selectedOption.getAttribute("data-shares");

    const input = document.getElementById("sharesInput");
    input.max = maxShares;
    input.value = "";
}

function setMax() {
    const select = document.getElementById("symbolSelect");
    const selectedOption = select.options[select.selectedIndex];
    const maxShares = selectedOption.getAttribute("data-shares");

    const input = document.getElementById("sharesInput");
    input.value = maxShares;
}
</script>

{% endblock %}
